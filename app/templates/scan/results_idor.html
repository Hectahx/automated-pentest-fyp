<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IDOR Vulnerability Reports</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='results_detailed.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='prism.css') }}">
    <script src="{{ url_for('static', filename='prism.js') }}"></script>
</head>
<body>

<div class="container mt-5">
    <h1 class="mb-4 text-center">IDOR Vulnerability Report</h1>

    {% for item in results %}
    <div class="card mb-4">
        {% if item.is_vulnerable %}
        <div class="card-header">
            URL: {{ item.url }}
        </div>
        <div class="card-body">
            <p><strong>Status:</strong> Vulnerable</p>
            <p><strong>Details:</strong> {{ item.message }}</p>
            <p>This indicates that the application does not properly enforce access controls, allowing unauthorized users to access or modify sensitive data belonging to other users. Such vulnerabilities can lead to data breaches, privacy violations, and unauthorized actions.</p>
            
            <p><strong>Note:</strong> The identification of vulnerabilities may include false positives due to the automated
                nature of the tests. Manual verification is recommended to confirm any findings, especially for IDOR
                vulnerabilities, where nuanced access control logic may not be fully assessed</p>

            <div class="fix-guide mt-3">
                <h4>How to Fix:</h4>
                <p>Implement robust authentication and authorization checks before accessing any user-specific resources. Here are examples of how to secure your application against IDOR vulnerabilities:</p>
                <ul class="nav nav-tabs" id="fixTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="python-tab" data-toggle="tab" href="#pythonIDOR" role="tab" aria-controls="python" aria-selected="true">Python</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="php-tab" data-toggle="tab" href="#phpIDOR" role="tab" aria-controls="php" aria-selected="false">PHP</a>
                    </li>
                </ul>
                <div class="tab-content" id="fixContent">
                    <div class="tab-pane fade show active" id="pythonIDOR" role="tabpanel" aria-labelledby="python-tab">
                        <pre><code class="language-python">
# Vulnerable Example
@app.route('/profile/&lt;id&gt;')
    def profile(id):
        # Vulnerable to IDOR: Directly using user-supplied input to fetch profile
        userProfile = f"http://example.com/api/users/{id}"  # Simplified for example
        return userProfile
    
# Secure Example
@app.route('/profile/&lt;id&gt;')
    def profile(id):
        if 'user_id' in session and session['user_id'] == id:
            # User is authorized to access this profile
            userProfile = f"http://example.com/api/users/{id}"
            return userProfile
        else:
            # User not authorized to access this profile
            return "Access denied!", 403
                        </code></pre>
                    </div>
                    <div class="tab-pane fade" id="phpIDOR" role="tabpanel" aria-labelledby="php-tab">
                        <pre><code class="language-php">
// Vulnerable Example
$id = $_GET['id']; // User-supplied input without validation
$userProfile = file_get_contents("http://example.com/api/users/${id}");
echo $userProfile;

// Secure Example
// Before accessing a user's profile, verify that the current user has the right to access the requested profile
session_start();
$id = $_GET['id']; // User-supplied input
$loggedInUserId = $_SESSION['user_id']; // User ID from session

if ($id == $loggedInUserId) {
    // Fetch and display the profile
    $userProfile = file_get_contents("http://example.com/api/users/${id}");
    echo $userProfile;
} else {
    // Access control check failed
    echo "Access denied!";
}
                        </code></pre>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="card-header">
                No IDOR Vulnerabilities Found
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
