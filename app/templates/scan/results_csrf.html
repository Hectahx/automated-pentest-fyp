<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSRF Vulnerability Reports</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='results_detailed.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='prism.css') }}">
    <script src="{{ url_for('static', filename='prism.js') }}"></script>
</head>
<body>

<div class="container mt-5">
    <h1 class="mb-4 text-center">CSRF Vulnerability Report</h1>

    {% for result in results %}
    {% if result.is_vulnerable %}
        <div class="card mb-4">
            <div class="card-body">
                <h3 class="card-title">URL: {{ result.url }}</h3>
                    <p class="mb-2"><strong>Vulnerable to CSRF:</strong> Yes</p>
                    {% if result.forms_without_csrf %}
                        <p>This has been detected as a form without a CSRF token.</p>
                        <h4>Form Example:</h4>
                        <ul class="nav nav-tabs" id="languageTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="html-tab" data-toggle="tab" href="#html" role="tab" aria-controls="html" aria-selected="true">HTML</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="profileTabsContent">
                            <div class="tab-pane fade show active" id="html" role="tabpanel" aria-labelledby="html-tab">
                            <pre><code class="language-html" >
    &lt;!-- Vulnerable Example --&gt;
    &lt;form action=&quot;/submit&quot; method=&quot;POST&quot;&gt;
        &lt;label for=&quot;email&quot;&gt;Email:&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; required&gt;
        &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
    &lt;/form&gt;

    &lt;!-- Secure Example --&gt;
    &lt;form action=&quot;/submit&quot; method=&quot;POST&quot;&gt;
        &lt;label for=&quot;email&quot;&gt;Email:&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; required&gt;
        &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;
        &lt;!-- CSRF token (hidden input) --&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;generated_csrf_token_here&quot;&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
    &lt;/form&gt;
                            </code></pre>
                        </div>
                        </div>
                    {% else %}
                        <p>This has been detected as an AJAX POST Request without a CSRF token.</p>
                        <h4>AJAX Request Example:</h4>
                        <ul class="nav nav-tabs" id="languageTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="js-tab" data-toggle="tab" href="#js" role="tab" aria-controls="js" aria-selected="true">JavaScript</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="profileTabsContent">
                            <div class="tab-pane fade show active" id="js" role="tabpanel" aria-labelledby="js-tab">
                            <pre><code class="language-js" >
    // Vulnerable Example
    $.ajax({
        url: "/submit_secure",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({"email": "email@example.com", "password" : "P@$$w0rD"}),
        success: function(response) {
            // Handle success
            console.log("Success:", response);
        },
        error: function(xhr, status, error) {
            // Handle error
            console.error("Error:", status, error);
        }
    });

    // Secure Example
    $.ajax({
        url: "/submit_secure",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({"email": "email@example.com", "password" : "P@$$w0rD"}),
        beforeSend: function(xhr) {
            // Set CSRF token in the request header
            xhr.setRequestHeader("X-CSRF-Token", "generated_csrf_token_here");
        },
        success: function(response) {
            // Handle success
            console.log("Success:", response);
        },
        error: function(xhr, status, error) {
            // Handle error
            console.error("Error:", status, error);
        }
    });
                            </code></pre>
                        </div>
                        </div>
                    {% endif %}

                    <div class="fix-guide mt-3">
                        <h4>How to Mitigate:</h4>
                        <p>Ensure that all forms and AJAX requests include a CSRF token that is validated server-side. Use secure and HTTPOnly cookies to prevent token theft.</p>
                    </div>
                </div>
            </div>
                {% else %}
                {% endif %}
    {% endfor %}
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
