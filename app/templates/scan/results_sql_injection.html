<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SQL Injection Vulnerability Reports</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='results_detailed.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='prism.css') }}">
    <script src="{{ url_for('static', filename='prism.js') }}"></script>
</head>
<body>
    
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" href="/">Automated Penetration Tester</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav ml-auto">
                {% if user.is_authenticated %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {{ user.username }}
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="/profile">View Profile</a>
                        <a class="dropdown-item" href="/auth/logout">Sign Out</a>
                    </div>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="/auth/login">Sign In</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/auth/register">Register</a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

    <div class="container mt-4">
        <h1 class="mb-4 text-center">SQL Injection Vulnerability Report</h1>

        {% for item in results %}
        <div class="card mb-3">
            <div class="card-header">
                Vulnerable URL: {{ item.url }}
            </div>
            <div class="card-body">
                <h4 class="card-title"><strong>Parameter:</strong> {{ item.vulns_found.parameter }}, <strong>Method:</strong> {{ item.vulns_found.method }}</h4>
                <div class="card-text">
                    <p class="insight">Insight: The vulnerability stems from 
                        {% if item.vulns_found.method == 'POST' %}form submission.
                        {% elif item.vulns_found.method == 'GET' %}URL parameters.
                        {% endif %}
                    </p>
                    <h5>Findings:</h5>
                    {% for sqli_type in item.vulns_found.sqli_types %}
                    <p><strong>SQLi Type:</strong> {{ sqli_type.type }}</p>
                    <p><strong>Title:</strong> {{ sqli_type.title }}</p>
                    <p><strong>Payload Used:</strong> {{ sqli_type.payload }}</p>
                    {% endfor %}
                </div>
                
                <div class="mt-3">
                    <h5>How to Fix:</h5>
                    <!-- Fix guidance based on method (POST/GET) -->
                    {% if item.vulns_found.method == 'POST' %}
                      <div class="fix-example">
                        <p>Use parameterized queries for POST data. Example in Python and PHP:</p>
                      </div>
                        <!-- Example code snippets -->
                        <ul class="nav nav-tabs" id="languageTabs" role="tablist">
                          <li class="nav-item">
                              <a class="nav-link active" id="python-post-tab" data-toggle="tab" href="#pythonPost" role="tab" aria-controls="python-post" aria-selected="true">Python</a>
                          </li>
                          <li class="nav-item">
                              <a class="nav-link" id="php-post-tab" data-toggle="tab" href="#phpPost" role="tab" aria-controls="php-post" aria-selected="false">PHP</a>
                          </li>
                      </ul>
                      <div class="tab-content" id="profileTabsContent">
                        <div class="tab-pane fade show active" id="pythonPost" role="tabpanel" aria-labelledby="python-post-tab">
                          <pre><code class="language-python" >
# Vulnerable Example
query = f"SELECT * FROM users WHERE {{ item.vulns_found.parameter }} = '{ {{ item.vulns_found.parameter }} }'"
cursor.execute(query)
results = cursor.fetchall()

# Secure Example
query = "INSERT INTO users ({{ item.vulns_found.parameter }}) VALUES (%s)"
cursor.execute(query, (form_data['{{ item.vulns_found.parameter }}'],))
                          </code></pre>
                      </div>
                      <div class="tab-pane fade" id="phpPost" role="tabpanel" aria-labelledby="php-post-tab">
                        <pre><code class="language-php">
// Vulnerable Example
$username = $_POST['{{ item.vulns_found.parameter }}'];
$query = "SELECT * FROM users WHERE {{ item.vulns_found.parameter }} = '${{ item.vulns_found.parameter }}'";
$result = mysqli_query($connection, $query);

// Secure Example
$stmt = $pdo->prepare("INSERT INTO users ({{ item.vulns_found.parameter }}) VALUES (?)");
$stmt->execute([$_POST['{{ item.vulns_found.parameter }}']]);
                        </code></pre>
                    </div>
                      </div>

                        {% elif item.vulns_found.method == 'GET' %}
                        <div class="fix-example">
                          <p>Sanitize and validate GET parameters. Example in Python and PHP:</p>
                        </div>
                        <ul class="nav nav-tabs" id="languageTabs" role="tablist">
                          <li class="nav-item">
                              <a class="nav-link active" id="python-get-tab" data-toggle="tab" href="#pythonGet" role="tab" aria-controls="python-get" aria-selected="true">Python</a>
                          </li>
                          <li class="nav-item">
                              <a class="nav-link" id="php-get-tab" data-toggle="tab" href="#phpGet" role="tab" aria-controls="php-get" aria-selected="false">PHP</a>
                          </li>
                      </ul>
                      <div class="tab-content" id="profileTabsContent">
                        <div class="tab-pane fade show active" id="pythonGet" role="tabpanel" aria-labelledby="python-get-tab">
                          <pre><code class="language-python">
# Vulnerable Example
{{ item.vulns_found.parameter }} = request.args.get('{{ item.vulns_found.parameter }}')
query = f"SELECT * FROM users WHERE {{ item.vulns_found.parameter }} = '{ {{ item.vulns_found.parameter }} }'"
conn = sqlite3.connect('database.db')
cursor = conn.cursor()
cursor.execute(query)
results = cursor.fetchall()

# Secure Example
{{ item.vulns_found.parameter }} = request.args.get('{{ item.vulns_found.parameter }}', type=int)
query = "SELECT * FROM users WHERE {{ item.vulns_found.parameter }} = %s"
cursor.execute(query, ({{ item.vulns_found.parameter }},))
</code></pre>
                      </div>
                      <div class="tab-pane fade" id="phpGet" role="tabpanel" aria-labelledby="php-get-tab">
                        <pre><code class="language-php">
# Vulnerable Example
$username = $_POST['{{ item.vulns_found.parameter }}'];
$query = "SELECT * FROM users WHERE {{ item.vulns_found.parameter }} = '${{ item.vulns_found.parameter }}'";
$result = mysqli_query($connection, $query);

# Secure Example
${{ item.vulns_found.parameter }} = filter_input(INPUT_GET, '{{ item.vulns_found.parameter }}', FILTER_SANITIZE_NUMBER_INT);
$stmt = $pdo->prepare("SELECT * FROM users WHERE {{ item.vulns_found.parameter }} = ?");
$stmt->execute([${{ item.vulns_found.parameter }}]);
                      </code></pre>
                    </div>
                      </div>
                        {% endif %}
                    
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
