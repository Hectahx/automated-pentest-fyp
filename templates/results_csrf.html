<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSRF Vulnerability Reports</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='results_detailed.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='prism.css') }}">
    <script src="{{ url_for('static', filename='prism.js') }}"></script>

</head>
<body>
    <h1>CSRF Vulnerability Reports</h1>

    {% for result in results %}
    <div class="report">
        <div class="vulnerability-details">
            {% if result.is_vulnerable %}
                <h2>URL: {{ result.url }}</h2>
                <h3>Assessment Details:</h3>
                <p><strong>Vulnerable to CSRF:</strong> Yes</p>
                {% if result.forms_without_csrf %}
                    <p class="insight">This has been detected as a form without a CSRF token </p>
                    <div class="tab">
                        <button class="tablinks active">HTML</button>
                    </div>
                    <div id="HTML" class="tabcontent" style="display: block;">
                        <code class="language-html" style="    display: block; white-space: pre-wrap ">
&lt;!-- Vulnerable Example --&gt;
&lt;form action=&quot;/submit&quot; method=&quot;POST&quot;&gt;
    &lt;label for=&quot;email&quot;&gt;Email:&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; required&gt;
    &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
&lt;/form&gt;

&lt;!-- Secure Example --&gt;
&lt;form action=&quot;/submit&quot; method=&quot;POST&quot;&gt;
    &lt;label for=&quot;email&quot;&gt;Email:&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; required&gt;
    &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;
    &lt;!-- CSRF token (hidden input) --&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;generated_csrf_token_here&quot;&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
&lt;/form&gt;
                        </code>
                    </div>
                {% else %}
                    <p class="insight">This has been detected as a AJAX POST Request without a CSRF token </p>
                    <div class="tab">
                        <button class="tablinks active">JavaScript</button>
                    </div>
                    <div id="JS" class="tabcontent" style="display: block;">
                        <code class="language-js" style="    display: block; white-space: pre-wrap ">
// Vulnerable Example
$.ajax({
    url: "/submit_secure",
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify({"email": "email@example.com", "password" : "P@$$w0rD"}),
    success: function(response) {
        // Handle success
        console.log("Success:", response);
    },
    error: function(xhr, status, error) {
        // Handle error
        console.error("Error:", status, error);
    }
});

// Secure Example
$.ajax({
    url: "/submit_secure",
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify({"email": "email@example.com", "password" : "P@$$w0rD"}),
    beforeSend: function(xhr) {
        // Set CSRF token in the request header
        xhr.setRequestHeader("X-CSRF-Token", "generated_csrf_token_here");
    },
    success: function(response) {
        // Handle success
        console.log("Success:", response);
    },
    error: function(xhr, status, error) {
        // Handle error
        console.error("Error:", status, error);
    }
});
                        </code>
                      </div>
                {% endif %}


            {% endif %}
        
        </div>
        
        {% if result.is_vulnerable %}
        <div class="fix-guide">
            <h3>How to Mitigate</h3>
            <p>Ensure that all forms and AJAX requests include a CSRF token that is validated server-side. Use secure and HTTPOnly cookies to prevent token theft.</p>
        </div>
        {% endif %}
    </div>
    {% endfor %}

</body>
</html>

