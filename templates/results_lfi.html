<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LFI Vulnerability Reports</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='results_detailed.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='prism.css') }}">
    <script src="{{ url_for('static', filename='prism.js') }}"></script>
</head>
<body>
    <h1>LFI Vulnerability Reports</h1>

    {% for item in results %}
    <div class="report">
        <h2>Vulnerable URL: {{ item.url }}</h2>
        {% if item.is_vulnerable %}
        <div class="overview">
            <p><strong>Number of Vulnerabilities Found:</strong> {{ item.vulns_found.num_vulns }}</p>
            <div class="vuln-techniques">
                <h3>Findings</h3>
                {% for vuln_url, technique in item.vulns_found.vuln_techniques.items() %}
                <div>
                    <h4><strong>LFI Technique:</strong> {{ technique | title }}</h4>
                    <p><strong>Payload Used:</strong> {{ vuln_url }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="fix-guide">
            <h3>How to Fix</h3>
            <p class="insight">Validate and sanitize input:</p>
            <div class="tab">
                <button class="tablinks active" onclick="openLang(event, 'PythonLFI')">Python</button>
                <button class="tablinks" onclick="openLang(event, 'PHPLFI')">PHP</button>
            </div>
            <div id="PHPLFI" class="tabcontent">
                <code class="language-php" style="    display: block; white-space: pre-wrap ">
// Secure Example
$path = $_GET['page'];
if (file_exists($path)) {
    // Ensure the file is within a specific directory
    if (strpos(realpath($path), realpath('/var/www/html/allowed_directory/')) === 0) {
        include($path);
    }
}
                </code>
            </div>
            <div id="PythonLFI" class="tabcontent" style="display: block;">
                <code class="language-python" style="    display: block; white-space: pre-wrap ">
# Secure Example
from flask import request, send_from_directory
path = request.args.get('page')
# Validate the path
if path and '..' not in path and path.startswith('allowed_directory/'):
    return send_from_directory('allowed_directory', path)
                </code>
            </div>
        </div>
        {% else %}
        <p>No LFI vulnerabilities found.</p>
        {% endif %}
    </div>
    {% endfor %}

    <script>
        function openLang(evt, cityName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
</body>
</html>