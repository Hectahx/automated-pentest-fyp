<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IDOR Vulnerability Reports</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='results_detailed.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='prism.css') }}">
    <script src="{{ url_for('static', filename='prism.js') }}"></script>
</head>
<body>
    <h1>IDOR Vulnerability Reports</h1>

    {% for item in results %}
    <div class="report">
        <h2>URL Checked: {{ item.url }}</h2>
        
        {% if item.is_vulnerable %}
        <p><strong>Status:</strong> Vulnerable</p>
        <p><strong>Details:</strong> {{ item.message }}</p>
        <p>This indicates that the application does not properly enforce access controls, allowing unauthorized users to access or modify sensitive data belonging to other users. Such vulnerabilities can lead to data breaches, privacy violations, and unauthorized actions.</p>
        <div class="fix-guide">
            <h3>How to Fix</h3>
            <p class="insight">Implement robust authentication and authorization checks before accessing any user-specific resources. Here are examples of how to secure your application against IDOR vulnerabilities:</p>
            <div class="tab">
                <button class="tablinks active" onclick="openLang(event, 'PythonLFI')">Python</button>
                <button class="tablinks" onclick="openLang(event, 'PHPLFI')">PHP</button>
            </div>
            <div id="PHPLFI" class="tabcontent">
                <code class="language-php" style="display: block; white-space: pre-wrap ">
// Vulnerable Example
$id = $_GET['id']; // User-supplied input without validation
$userProfile = file_get_contents("http://example.com/api/users/${id}");
echo $userProfile;

// Secure Example
// Before accessing a user's profile, verify that the current user has the right to access the requested profile
session_start();
$id = $_GET['id']; // User-supplied input
$loggedInUserId = $_SESSION['user_id']; // User ID from session

if ($id == $loggedInUserId) {
    // Fetch and display the profile
    $userProfile = file_get_contents("http://example.com/api/users/${id}");
    echo $userProfile;
} else {
    // Access control check failed
    echo "Access denied!";
}
                </code>
            </div>
            <div id="PythonLFI" class="tabcontent" style="display: block;">
                <code class="language-python" style="display: block; white-space: pre-wrap ">
# Vulnerable Example
@app.route('/profile/&lt;id&gt;')
    def profile(id):
        # Vulnerable to IDOR: Directly using user-supplied input to fetch profile
        userProfile = f"http://example.com/api/users/{id}"  # Simplified for example
        return userProfile
    
# Secure Example
@app.route('/profile/&lt;id&gt;')
    def profile(id):
        if 'user_id' in session and session['user_id'] == id:
            # User is authorized to access this profile
            userProfile = f"http://example.com/api/users/{id}"
            return userProfile
        else:
            # User not authorized to access this profile
            return "Access denied!", 403
                </code>
            </div>
        </div>
        {% else %}
        <p><strong>Status:</strong> Not Vulnerable</p>
        {% endif %}
    </div>
    {% endfor %}

    <script>
        function openLang(evt, cityName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
</body>
</html>